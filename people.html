<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Ocular-Motor lab - People</title>

  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>
  <script src="tailwind-config.js"></script>
  <script src="nav.js"></script>
</head>

<body class="bg-gray-100 min-h-screen font-sans antialiased">
  <!-- Navigation injected by nav.js -->

  <main class="container mx-auto px-4 pt-24 pb-12">
    <section id="current-section" aria-labelledby="current-heading">
      <h2 id="current-heading" class="text-2xl font-bold text-gray-800 mb-6 border-l-4 border-accent-blue pl-3">
        Current Lab Members
      </h2>

      <ul id="people-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-8" role="list"
        aria-label="Current lab members"></ul>
    </section>

    <section id="alumni-section" class="mt-16 hidden" aria-labelledby="alumni-heading">
      <h2 id="alumni-heading" class="text-2xl font-bold text-gray-800 mb-4 border-l-4 border-gray-400 pl-3">
        Alumni
      </h2>

      <ul id="alumni-list" class="space-y-2 text-gray-700 list-none" role="list" aria-label="Lab alumni"></ul>
    </section>

    <div id="error" class="hidden p-4 mt-8 bg-red-100 border border-red-400 text-red-700 rounded" role="alert"
      aria-live="polite">
      <p class="font-bold">Error Loading Data</p>
      <p id="error-details"></p>
    </div>
  </main>

  <script>
    const FILE_PATH = 'people.csv';
    const EXTERNAL_ATTRS = 'target="_blank" rel="noopener noreferrer"';

    function togglePIBio(btn) {
      const card = btn.closest('.pi-card');
      if (!card) return;

      const front = card.querySelector('.pi-front');
      const bio = card.querySelector('.pi-bio');
      if (!front || !bio) return;

      const showBio = bio.classList.contains('hidden');
      front.classList.toggle('hidden', showBio);
      bio.classList.toggle('hidden', !showBio);

      // Keep both toggle buttons in sync
      card.querySelectorAll('button[data-pi-toggle]').forEach(b => {
        b.setAttribute('aria-expanded', String(showBio));
        b.textContent = showBio ? 'Back' : 'Bio';
      });
    }

    function renderPersonHTML(person, type, idx) {
      const name = (person.name || '').trim();
      const position = (person.position || '').trim();
      const link = (person.link || '').trim();
      const imageFilename = (person.image || '').trim();

      const initials = name ? name.split(/\s+/).map(n => n[0]).join('').slice(0, 2) : '??';
      const placeholderSrc = `https://placehold.co/200x200/cccccc/666666?text=${encodeURIComponent(initials)}`;
      const imageSrc = imageFilename ? `images/${imageFilename}` : placeholderSrc;

      const websiteBtn = link
        ? `<a href="${link}" ${EXTERNAL_ATTRS}
              class="inline-block px-4 py-1.5 text-sm font-medium text-accent-text border border-accent-blue rounded-full hover:bg-accent-blue hover:text-black transition-colors">
             Website<span class="sr-only"> for ${name}</span>
           </a>`
        : '';

      if (type === 'alumnus') {
        const linkIcon = link
          ? `<a href="${link}" ${EXTERNAL_ATTRS}
                class="ml-2 text-accent-text hover:text-blue-700 inline-flex items-center"
                aria-label="Website for ${name}">
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                        d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4m-4-2h4m-4 0l4-4m-4 4l-4-4"></path>
                </svg>
              </a>`
          : '';

        return `
          <li class="text-base bg-white p-3 rounded shadow-sm border border-gray-100 hover:shadow-md transition-shadow">
            <span class="font-semibold text-gray-900">${name}</span>
            ${position ? `<span class="text-gray-600">, ${position}</span>` : ''}
            ${linkIcon}
          </li>`;
      }

      if (type === 'lead') {
        const bioId = `pi-bio-${idx}`;

        return `
          <li class="pi-card bg-white p-6 rounded-xl shadow-md border border-gray-100 flex flex-col items-center text-center hover:shadow-xl transition-shadow duration-300 h-full"
              aria-label="Principal investigator: ${name}">
            <div class="pi-front w-full flex flex-col items-center text-center h-full">
              <div class="mb-4">
                <img src="${imageSrc}" alt="${name}" loading="lazy"
                     class="w-32 h-32 rounded-full object-cover border-2 border-gray-200 shadow-sm"
                     onerror="this.onerror=null; this.src='${placeholderSrc}';" />
              </div>

              <h3 class="text-lg font-bold text-gray-900 leading-tight mb-1">${name}</h3>
              <p class="text-sm text-gray-600 mb-4 flex-grow">${position}</p>

              <div class="flex justify-center gap-3">
                <button type="button"
                        data-pi-toggle
                        aria-controls="${bioId}"
                        aria-expanded="false"
                        onclick="togglePIBio(this)"
                        class="px-5 py-1.5 text-sm font-medium text-accent-gray bg-nav-blue rounded-full hover:bg-gray-700 transition-colors shadow-sm">
                  Bio
                </button>

                <a href="cv/Otero-MillanCV.pdf" ${EXTERNAL_ATTRS}
                   class="px-5 py-1.5 text-sm font-medium text-accent-text border border-accent-blue rounded-full hover:bg-accent-blue hover:text-black transition-colors shadow-sm">
                  CV<span class="sr-only"> for ${name}</span>
                </a>
              </div>
            </div>

            <div id="${bioId}" class="pi-bio hidden w-full h-full flex flex-col" role="region" aria-label="Bio for ${name}">
              <div class="text-sm text-gray-700 leading-relaxed space-y-3 flex-grow text-left">
                <p>
                  I am an assistant professor in the
                  <a href="https://optometry.berkeley.edu/" ${EXTERNAL_ATTRS}
                     class="text-accent-text hover:underline font-medium">School of Optometry</a> 
                     and an adjunct assistant professor in the 
                     <a href="https://www.hopkinsmedicine.org/neurology-neurosurgery/" ${EXTERNAL_ATTRS}
                        class="text-accent-text hover:underline font-medium">Department of Neurology at Johns Hopkins University</a>. 
                        I am also the director of the  
                     <a href="https://civo.berkeley.edu/ " ${EXTERNAL_ATTRS}
                        class="text-accent-text hover:underline font-medium">Center for Innocation in Vision and Optics</a> and
                      chair of the
                     <a href="https://www.grc.org/eye-movements-conference/" ${EXTERNAL_ATTRS}
                        class="text-accent-text hover:underline font-medium">Gordon Research Conference on Eye Movements.</a> 
                      
                </p>
              </div>

              <div class="mt-4 flex items-center justify-center gap-3 flex-wrap">
                <button type="button"
                        data-pi-toggle
                        aria-controls="${bioId}"
                        aria-expanded="true"
                        onclick="togglePIBio(this)"
                        class="inline-block px-4 py-1.5 text-sm font-medium text-white bg-nav-blue rounded-full hover:bg-gray-700 transition-colors shadow-sm">
                  Back
                </button>

                <a href="cv/Otero-MillanCV.pdf" ${EXTERNAL_ATTRS}
                   class="px-5 py-1.5 text-sm font-medium text-accent-text border border-accent-blue rounded-full hover:bg-accent-blue hover:text-black transition-colors shadow-sm">
                  CV<span class="sr-only"> for ${name}</span>
                </a>
              </div>
            </div>
          </li>`;
      }

      return `
        <li class="bg-white p-6 rounded-xl shadow-md border border-gray-100 flex flex-col items-center text-center hover:shadow-xl transition-shadow duration-300 h-full">
          <div class="mb-4">
            <img src="${imageSrc}" alt="${name}" loading="lazy"
                 class="w-32 h-32 rounded-full object-cover border-2 border-gray-200 shadow-sm"
                 onerror="this.onerror=null; this.src='${placeholderSrc}';" />
          </div>

          <h3 class="text-lg font-bold text-gray-900 leading-tight mb-1">${name}</h3>
          <p class="text-sm text-gray-600 mb-4 flex-grow">${position}</p>
          ${websiteBtn}
        </li>`;
    }

    function init() {
      if (typeof renderNavigation === 'function') renderNavigation('people.html');

      Papa.parse(FILE_PATH, {
        download: true,
        header: true,
        skipEmptyLines: true,
        complete: ({ data }) => {
          const membersGrid = document.getElementById('people-grid');
          const alumniGrid = document.getElementById('alumni-list');
          const alumniSection = document.getElementById('alumni-section');

          let piPerson = null;
          const currentMembers = [];
          const alumni = [];

          data.forEach(p => {
            const name = (p.name || '').trim();
            const isAlumni = (p.alumni == '1');

            if (name === 'Jorge Otero-Millan') {
              piPerson = p;
              return;
            }
            (isAlumni ? alumni : currentMembers).push(p);
          });

          currentMembers.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
          if (piPerson) currentMembers.unshift(piPerson);

          membersGrid.innerHTML = currentMembers
            .map((p, i) => renderPersonHTML(p, (piPerson && p === piPerson) ? 'lead' : 'member', i))
            .join('');

          alumni.sort((a, b) => (a.name || '').localeCompare(b.name || ''));
          alumniGrid.innerHTML = alumni.map((p, i) => renderPersonHTML(p, 'alumnus', i)).join('');

          if (alumni.length) alumniSection.classList.remove('hidden');
        },
        error: (err) => {
          console.error('PapaParse Error:', err);
          document.getElementById('error').classList.remove('hidden');
          document.getElementById('error-details').textContent = err.message;
        }
      });
    }

    window.addEventListener('load', init);
  </script>
</body>

</html>